<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>My Food Logs</title>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
            rel="stylesheet"/>
    <style>
        /* Make the table body vertically scrollable if it grows too tall */
        #logsTableWrapper {
            max-height: 60vh; /* at most 60% of viewport height */
            overflow-y: auto;
        }
    </style>
</head>
<body>

<!-- navbar fragment -->
<div th:replace="~{fragments/header :: siteHeader}"></div>

<main class="container py-4">
    <h1>My Food Logs</h1>
    <div class="mt-3" id="logsContainer">
        <p class="text-muted">Loadingâ€¦</p>
    </div>
</main>

<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js">
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const container = document.getElementById('logsContainer');

        fetch('/logsRetrieve')
            .then(response => {
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return response.json();
            })
            .then(logs => {
                if (!logs.length) {
                    container.innerHTML = `
              <div class="alert alert-info">No logs found.</div>
            `;
                    return;
                }

                // Build a wide table with all nutrient columns
                let html = `
            <div class="table-responsive" style="overflow-x:auto;">
              <div id="logsTableWrapper">
                <table class="table table-hover table-sm">
                  <thead class="table-light position-sticky top-0">
                    <tr>
                      <th>Date</th>
                      <th>Meal</th>
                      <th>Brand/Food</th>
                      <th>Servings</th>
                      <th>Mass</th>
                      <th>Calories</th>
                      <th>Total_Fat</th>
                      <th>Sat._Fat</th>
                      <th>Trans_Fat</th>
                      <th>Polyunsat._Fat</th>
                      <th>Monounsat._Fat</th>
                      <th>Carbs</th>
                      <th>Fiber</th>
                      <th>Protein</th>
                      <th>Cholesterol</th>
                      <th>Sodium</th>
                      <th>Sugar</th>
                      <th>Potassium</th>
                      <th>Calcium</th>
                      <th>Iron</th>
                      <th>Vitamin_A</th>
                      <th>Vitamin_C</th>
                      <th>Vitamin_D</th>
                    </tr>
                  </thead>
                  <tbody>
          `;

                logs.forEach(log => {
                    html += `
              <tr>
                <td>${new Date(log.loggedAt).toLocaleString()}</td>
                <td>${log.mealType}</td>
                <td>${log.brandName}</td>
                <td>${log.servingSize} g</td>
                <td>${log.servings}</td>
                <td>${log.calories} kcal</td>
                <td>${log.fat} g</td>
                <td>${log.saturatedFat} g</td>
                <td>${log.transFat} g</td>
                <td>${log.polyunsaturatedFat} g</td>
                <td>${log.monounsaturatedFat} g</td>
                <td>${log.carbs} g</td>
                <td>${log.fiber} g</td>
                <td>${log.protein} g</td>
                <td>${log.cholesterol} mg</td>
                <td>${log.sodium} mg</td>
                <td>${log.sugar} g</td>
                <td>${log.potassium} mg</td>
                <td>${log.calcium} mg</td>
                <td>${log.iron}&nbsp;mg</td>
                <td>${log.vitaminA} mcg</td>
                <td>${log.vitaminC} mg</td>
                <td>${log.vitaminD} mcg</td>
              </tr>
            `;
                });

                html += `
                  </tbody>
                </table>
              </div>
            </div>
          `;
                container.innerHTML = html;
            })
            .catch(err => {
                console.error(err);
                container.innerHTML = `
            <div class="alert alert-danger">
              Failed to load logs: ${err.message}
            </div>
          `;
            });
    });
</script>
</body>
</html>
