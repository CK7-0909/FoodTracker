<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>My Food Logs</title>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
            rel="stylesheet"/>
    <style>
        /* Make the table body vertically scrollable if it grows too tall */
        #logsTableWrapper {
            max-height: 60vh; /* at most 60% of viewport height */
            overflow-y: auto;
        }
    </style>
</head>
<body>

<!-- navbar fragment -->
<div th:replace="fragments/header :: siteHeader"></div>

<main class="container py-4">
    <h1>My Food Logs</h1>
    <div class="mt-3" id="logsContainer">
        <p class="text-muted">Loading…</p>
    </div>
</main>

<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js">
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const container = document.getElementById('logsContainer');

        fetch('/logsRetrieve')
            .then(response => {
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return response.json();
            })
            .then(logs => {
                if (!logs.length) {
                    container.innerHTML = `
              <div class="alert alert-info">No logs found.</div>
            `;
                    return;
                }

                // Build a wide table with all nutrient columns
                let html = `
            <div class="table-responsive" style="overflow-x:auto;">
              <div id="logsTableWrapper">
                <table class="table table-hover table-sm">
                  <thead class="table-light position-sticky top-0">
                    <tr>
                      <th>Date</th>
                      <th>Meal</th>
                      <th>Brand/Food</th>
                      <th>Serving</th>
                      <th>Calories</th>
                      <th>Fat</th>
                      <th>Sat. Fat</th>
                      <th>Trans Fat</th>
                      <th>Carbs</th>
                      <th>Fiber</th>
                      <th>Protein</th>
                      <th>Cholesterol</th>
                      <th>Sodium</th>
                      <th>Sugar</th>
                    </tr>
                  </thead>
                  <tbody>
          `;

                logs.forEach(log => {
                    html += `
              <tr>
                <td>${new Date(log.loggedAt).toLocaleString()}</td>
                <td>${log.mealType}</td>
                <td>${log.brandName}</td>
                <td>${log.servingSize} × ${log.servings}</td>
                <td>${log.calories}</td>
                <td>${log.fat}</td>
                <td>${log.saturatedFat}</td>
                <td>${log.transFat}</td>
                <td>${log.carbs}</td>
                <td>${log.fiber}</td>
                <td>${log.protein}</td>
                <td>${log.cholesterol}</td>
                <td>${log.sodium}</td>
                <td>${log.sugar}</td>
              </tr>
            `;
                });

                html += `
                  </tbody>
                </table>
              </div>
            </div>
          `;
                container.innerHTML = html;
            })
            .catch(err => {
                console.error(err);
                container.innerHTML = `
            <div class="alert alert-danger">
              Failed to load logs: ${err.message}
            </div>
          `;
            });
    });
</script>
</body>
</html>
